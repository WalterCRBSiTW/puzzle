<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <title>puzzle</title>
    <style>
      body {
        background-color: black;
        font-family: 微軟正黑體;
      }
      img {
        height: 500px;
        width: 500px;
      }

      #dvPuzzle {
        width: 510px;
        height: 510px;
        border: solid 5px rgb(255, 226, 62);
        padding: 0px;
        margin: 20px auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-4 text-center">
          <button
            type="button"
            class="btn btn-secondary rounded"
            style="height:73%; width: 55%; margin:10px 0;"
            align="center"
            value="start"
            data-toggle="modal"
            data-target="#restore"
          >
            復原
          </button>
        </div>
        <div class="col-4 text-center ">
          <button
            id="start"
            type="button"
            class="btn btn-secondary rounded"
            style=" height:73%; width: 80%; margin:10px 0;"
            align="center"
            value="start"
          >
            開始拼圖
          </button>
        </div>
        <div class="col-4 text-center ">
          <button
            type="button"
            class="btn btn-secondary rounded"
            style="height:73%; width: 55%; margin:10px 0;"
            align="center"
            data-toggle="modal"
            data-target="#Dcn"
          >
            說明
          </button>
        </div>

        <div class="col-6" id="pz1">
          <div id="dvPuzzle"></div>
        </div>
        <div class="col-6" id="pz2">
          <img
            src="/20181112_233622_0001.png"
            alt=""
            style="display:block; margin:20px auto;"
          />
        </div>
      </div>
      <div
        class="modal fade"
        id="Dcn"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content border-0" style="opacity:0.8;">
            <div
              class="modal-header border-bottom-0"
              style="background-color:rgb(37, 37, 37);"
            >
              <h5
                class="modal-title"
                style="color: white"
                id="exampleModalCenterTitle"
              >
                遊戲攻略
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
                style="color: white;"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div
              class="modal-body"
              style="background-color:rgb(37, 37, 37); color: white;"
            >
              整體思路：從上往下，從左向右；第一排優先把前三個完成，這個完成步驟很簡單，因為格子多，所以都能完成，自我發揮吧。
            </div>
            <div
              class="modal-footer border-top-0"
              style="background-color:rgb(37, 37, 37);"
            >
              <button
                type="button"
                class="btn btn-outline-light"
                data-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <div
        class="modal fade"
        id="restore"
        tabindex="-1"
        role="dialog"
        aria-labelledby="exampleModalCenterTitle"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content border-0" style="opacity:0.8;">
            <div
              class="modal-header border-bottom-0"
              style="background-color:rgb(207, 45, 45);"
            >
              <h5
                class="modal-title"
                style="color: white"
                id="exampleModalCenterTitle"
              >
                重要訊息
              </h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
                style="color: white;"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div
              class="modal-body"
              style="background-color:rgb(207, 45, 45); color: white; text-align: center;"
            >
              確定恢復拼圖，放棄本局嗎?
            </div>
            <div
              class="modal-footer border-top-0"
              style="background-color:rgb(207, 45, 45);"
            >
              <button
                type="button"
                class="btn btn-outline-light"
                data-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script>
      start();
      function start() {
        var allPos = {}; //???????  座標的寫法
        //製作16張圖
        for (var i = 0; i < 16; i++) {
          $("#dvPuzzle").append(
            "<div class='PicCell overflow-hidden float-left border border-light' style='width:125px;height:125px;' id='Pic" +
              i +
              "'><img src='/20181112_233622_0001.png'/></div>"
          );
          var y = parseInt(i / 4);
          var x = i % 4;
          $("#Pic" + i + " img")
            .css("margin-left", x * -125)
            .css("margin-top", y * -125);
          //第i個換成第row列第col行
          allPos[i] = { row: y, col: x };
          // console.log(x, y);
          //取得 i 四周相鄰的位置
          function getAroundPos(i) {
            var around = [];
            var y = allPos[i].row;
            var x = allPos[i].col;
            if (y > 0) {
              //上
              around.push((y - 1) * 4 + x);
            }
            if (y < 4) {
              //下
              around.push((y + 1) * 4 + x);
            }
            if (x > 0) {
              //左
              around.push(i - 1);
            }
            if (x < 4) {
              //右
              around.push(i + 1);
            }
            // console.log(around);
            return around;
          }
        }
        //點及事件
        $(".PicCell").click(function() {
          var cells = $("#dvPuzzle div");
          var i = cells.index(this); //获得元素相对于选择器的 index 位置
          var toCheck = getAroundPos(i);
          // console.log(toCheck);   //找出元素是第幾個
          while (toCheck.length > 0) {
            var j = toCheck.pop();
            // console.log(j);
            if (cells.eq(j).attr("id") == "Pic0") {
              //如果上下左右有 0 則交換位置
              if (i > j) {
                //??????????????
                var k = j;
                j = i;
                i = k;
              }
              var ahead = cells.eq(i);
              var behind = cells.eq(j);
              var behindPrev = behind.prev();

              if (Math.abs(i - j) == 1) {
                //左右對調
                behind.after(ahead);
              } else {
                //上下對調
                ahead.after(behind);
                behindPrev.after(ahead);
              }
              if (
                $("#Pic1").index() == 1 &&
                $("#Pic2").index() == 2 &&
                $("#Pic3").index() == 3 &&
                $("#Pic4").index() == 4 &&
                $("#Pic5").index() == 5 &&
                $("#Pic6").index() == 6 &&
                $("#Pic7").index() == 7 &&
                $("#Pic8").index() == 8 &&
                $("#Pic9").index() == 9 &&
                $("#Pic10").index() == 10 &&
                $("#Pic11").index() == 11 &&
                $("#Pic12").index() == 12 &&
                $("#Pic13").index() == 13 &&
                $("#Pic14").index() == 14 &&
                $("#Pic15").index() == 15
              ) {
                alert("恭喜過關");
                $("#Pic0 img").show();
                window.location.reload();
                $(".PicCell").off("click", PicCell);
              }
              break;
            }
          }
        });

        $("#start").click(function() {
          $("#start").text("重新打亂");

          $("#Pic0 img").hide();
          for (var i = 0; i < 500; i++) {
            var cells = $("#dvPuzzle div");
            var toMove = getAroundPos(cells.index($("#Pic0")[0]));
            cells.eq(toMove[parseInt(Math.random() * toMove.length)]).click();
          }
        });
      }
      $("#restore").click(function() {
        window.location.reload();
      });

      // $(document).load($(window).bind("resize", checkPosition));  //.load()加載   .bind()單擊事件  resize

      // function checkPosition() {
      //   var a = ($(window).width());
      //   console.log(a);
      //   if ($(window).width() < 900) {
      //     $("#pz1", "#pz2")
      //       .attr("class", "col-12")
      //   }
      // }
      $(document).ready(function() {
        var a = $(window).width();
          console.log(a);
          if (a < 1200) {
            $("#pz1").attr("class", "col-12");
            $("#pz2").attr("class", "col-12");
          }
          else {
            $("#pz1").attr("class", "col-6");
            $("#pz2").attr("class", "col-6");
          }
        $(window).resize(function() { //当调整浏览器窗口的大小时，发生 resize 事件。
          var a = $(window).width();
          console.log(a);
          if (a < 1200) {
            $("#pz1").attr("class", "col-12");
            $("#pz2").attr("class", "col-12");
          }
          else {
            $("#pz1").attr("class", "col-6");
            $("#pz2").attr("class", "col-6");
          }
        });
      });
    </script>
  </body>
</html>
